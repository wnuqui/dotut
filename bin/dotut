#!/usr/bin/env node

var program   = require('commander')
  , tutorials = require('../index')

var actionFn = function (options) {
  var successFn = function(response) {
    response.body.hits.forEach(function(hit) {
      console.log('\n')
      console.log('Title:      ' + hit.title)
      console.log('URL:        ' + hit.url)
      console.log('Page Views: ' + hit.pageviews)
    })
  }

  var errorFn = function(error) {
    console.log(error)
  }

  var getTutorialsFn = function() {
    var query = {}

    query.per_page        = options.parent.perPage || 21
    query.page            = options.parent.page || 1
    query.q               = options.parent.query || ''
    query.primary_filter  = options.parent.sortBy || 'newest'

    tutorials.get(query).then(successFn).catch(errorFn)
  }

  getTutorialsFn()
}

program
  .version('dotut version 0.0.1')
  .usage('list [options]')
  .description('List tutorials from Digital Ocean.')

  .option('-s, --sort-by <sort_by>',    'sort results (valid values are: newest, popular, trending, series)')
  .option('-p, --page <page>',          'page number')
  .option('-n, --per-page <per_page>',  'number of results per page')
  .option('-q, --query <query>',        'optional keyword to search')

  .command('list')
  .action(actionFn)

program.parse(process.argv)

if (!program.args.length) program.help()
